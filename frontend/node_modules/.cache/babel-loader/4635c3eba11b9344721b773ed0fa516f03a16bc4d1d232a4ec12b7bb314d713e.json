{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from'react';import api from'../services/api';// Create context\nimport{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();// Auth provider component\nexport const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[token,setToken]=useState(localStorage.getItem('token'));const[loading,setLoading]=useState(true);// Debug function\nconst debugState=()=>{console.log('AuthContext - Current state:',{user:user,token:token,loading:loading,localStorage_token:localStorage.getItem('token')});};// Check if user is authenticated on app load\nuseEffect(()=>{console.log('AuthContext - useEffect triggered, verifying token...');const verifyToken=async()=>{const storedToken=localStorage.getItem('token');console.log('AuthContext - Stored token:',storedToken?'exists':'not found');if(storedToken){try{// Set token in API headers\napi.defaults.headers.common['Authorization']=`Bearer ${storedToken}`;console.log('AuthContext - Verifying token with backend...');// Verify token with backend\nconst response=await api.get('/auth/verify');console.log('AuthContext - Token verification successful:',response.data.user);setUser(response.data.user);setToken(storedToken);}catch(error){// Token is invalid, remove it\nconsole.log('AuthContext - Token verification failed:',error.message);localStorage.removeItem('token');delete api.defaults.headers.common['Authorization'];setUser(null);setToken(null);}}setLoading(false);console.log('AuthContext - Verification complete, loading set to false');};verifyToken();},[]);// Login function\nconst login=async(userData,userToken)=>{try{console.log('AuthContext - Login called with:',userData,'token:',userToken?'provided':'missing');// Store token\nlocalStorage.setItem('token',userToken);setToken(userToken);// Set token in API headers\napi.defaults.headers.common['Authorization']=`Bearer ${userToken}`;// Store user data\nsetUser(userData);console.log('AuthContext - Login successful, user set:',userData);debugState();return{success:true};}catch(error){console.error('AuthContext - Login error:',error);return{success:false,error:error.message};}};// Logout function\nconst logout=()=>{console.log('AuthContext - Logout called');localStorage.removeItem('token');delete api.defaults.headers.common['Authorization'];setUser(null);setToken(null);debugState();};// Check if user has specific role\nconst hasRole=requiredRole=>{return(user===null||user===void 0?void 0:user.role)===requiredRole;};// Role check helpers\nconst isAdmin=()=>(user===null||user===void 0?void 0:user.role)==='admin';const isProfessor=()=>(user===null||user===void 0?void 0:user.role)==='professor';const isStudent=()=>(user===null||user===void 0?void 0:user.role)==='student';// Get user info (for debugging)\nconst getUserInfo=()=>({user:user,token:token,isAuthenticated:!!user,role:user===null||user===void 0?void 0:user.role});const value={user,token,loading,login,logout,hasRole,isAdmin,isProfessor,isStudent,getUserInfo,debugState};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};// Custom hook to use auth context\nexport const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthProvider');}return context;};export default AuthContext;","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","api","jsx","_jsx","AuthContext","AuthProvider","_ref","children","user","setUser","token","setToken","localStorage","getItem","loading","setLoading","debugState","console","log","localStorage_token","verifyToken","storedToken","defaults","headers","common","response","get","data","error","message","removeItem","login","userData","userToken","setItem","success","logout","hasRole","requiredRole","role","isAdmin","isProfessor","isStudent","getUserInfo","isAuthenticated","value","Provider","useAuth","context","Error"],"sources":["/home/mounikavemula/Documents/PROJECT/quizManagement/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\nimport api from '../services/api';\n\n// Create context\nconst AuthContext = createContext();\n\n// Auth provider component\nexport const AuthProvider = ({ children }) => {\n    const [user, setUser] = useState(null);\n    const [token, setToken] = useState(localStorage.getItem('token'));\n    const [loading, setLoading] = useState(true);\n\n    // Debug function\n    const debugState = () => {\n        console.log('AuthContext - Current state:', {\n            user: user,\n            token: token,\n            loading: loading,\n            localStorage_token: localStorage.getItem('token')\n        });\n    };\n\n    // Check if user is authenticated on app load\n    useEffect(() => {\n        console.log('AuthContext - useEffect triggered, verifying token...');\n        const verifyToken = async () => {\n            const storedToken = localStorage.getItem('token');\n            console.log('AuthContext - Stored token:', storedToken ? 'exists' : 'not found');\n            \n            if (storedToken) {\n                try {\n                    // Set token in API headers\n                    api.defaults.headers.common['Authorization'] = `Bearer ${storedToken}`;\n                    console.log('AuthContext - Verifying token with backend...');\n                    \n                    // Verify token with backend\n                    const response = await api.get('/auth/verify');\n                    console.log('AuthContext - Token verification successful:', response.data.user);\n                    \n                    setUser(response.data.user);\n                    setToken(storedToken);\n                } catch (error) {\n                    // Token is invalid, remove it\n                    console.log('AuthContext - Token verification failed:', error.message);\n                    localStorage.removeItem('token');\n                    delete api.defaults.headers.common['Authorization'];\n                    setUser(null);\n                    setToken(null);\n                }\n            }\n            setLoading(false);\n            console.log('AuthContext - Verification complete, loading set to false');\n        };\n\n        verifyToken();\n    }, []);\n\n    // Login function\n    const login = async (userData, userToken) => {\n        try {\n            console.log('AuthContext - Login called with:', userData, 'token:', userToken ? 'provided' : 'missing');\n            \n            // Store token\n            localStorage.setItem('token', userToken);\n            setToken(userToken);\n            \n            // Set token in API headers\n            api.defaults.headers.common['Authorization'] = `Bearer ${userToken}`;\n            \n            // Store user data\n            setUser(userData);\n            \n            console.log('AuthContext - Login successful, user set:', userData);\n            debugState();\n            return { success: true };\n        } catch (error) {\n            console.error('AuthContext - Login error:', error);\n            return { success: false, error: error.message };\n        }\n    };\n\n    // Logout function\n    const logout = () => {\n        console.log('AuthContext - Logout called');\n        localStorage.removeItem('token');\n        delete api.defaults.headers.common['Authorization'];\n        setUser(null);\n        setToken(null);\n        debugState();\n    };\n\n    // Check if user has specific role\n    const hasRole = (requiredRole) => {\n        return user?.role === requiredRole;\n    };\n\n    // Role check helpers\n    const isAdmin = () => user?.role === 'admin';\n    const isProfessor = () => user?.role === 'professor';\n    const isStudent = () => user?.role === 'student';\n\n    // Get user info (for debugging)\n    const getUserInfo = () => ({\n        user: user,\n        token: token,\n        isAuthenticated: !!user,\n        role: user?.role\n    });\n\n    const value = {\n        user,\n        token,\n        loading,\n        login,\n        logout,\n        hasRole,\n        isAdmin,\n        isProfessor,\n        isStudent,\n        getUserInfo,\n        debugState\n    };\n\n    return (\n        <AuthContext.Provider value={value}>\n            {children}\n        </AuthContext.Provider>\n    );\n};\n\n// Custom hook to use auth context\nexport const useAuth = () => {\n    const context = useContext(AuthContext);\n    if (!context) {\n        throw new Error('useAuth must be used within an AuthProvider');\n    }\n    return context;\n};\n\nexport default AuthContext; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}